
MSGFMT = msgfmt
XGETTEXT = xgettext
MSGMERGE = msgmerge

MOFILES = de.mo es.mo it.mo nl.mo ru.mo sv.mo
LINGUAS = de es it nl ru sv
POTFILES = ../src/mp_conf.c ../src/mp_func.c ../src/mp_func_i.h ../src/mp_iface.c ../src/mp_lang.c ../src/mp_lang.h ../src/mp_tags.c ../src/mpv_curses.c ../src/mp_video.c ../src/mpv_unix_common.c ../src/mp_wordp.c

all: all-$(USE_NLS)
all-yes: $(MOFILES)
all-no:

$(GETTEXT_PACKAGE).pot: $(POTFILES)
	$(XGETTEXT) --default-domain=$(GETTEXT_PACKAGE) \
	--add-comments --keyword=_ --keyword=N_ --from-code=UTF-8 \
	-o $(GETTEXT_PACKAGE).pot $(POTFILES)

install: install-data-$(USE_NLS)
install-data-no: all
install-data-yes: all
	catalogs="$(LINGUAS)"; \
	for cat in $$catalogs; do \
	  dir=$(DESTDIR)$(localedir)/$$cat/LC_MESSAGES; \
	  mkdir -p $$dir; \
	  $(INSTALL_DATA) $$cat.mo $$dir/$(GETTEXT_PACKAGE).mo; \
	  echo "installing $$cat.mo as $$dir/$(GETTEXT_PACKAGE).mo"; \
	done

strip:

install-strip: install

uninstall:
	catalogs="$(LINGUAS)"; \
	for cat in $$catalogs; do \
	  echo "rm -f $(DESTDIR)$(localedir)/$$cat/LC_MESSAGES/$(GETTEXT_PACKAGE).mo"; \
	  rm -f $(DESTDIR)$(localedir)/$$cat/LC_MESSAGES/$(GETTEXT_PACKAGE).mo; \
	done

mostlyclean:
	rm -f *.new.po *.mo *.gmo

clean: mostlyclean

distclean: clean
	rm -f Makefile

update-po: Makefile
	rm -f $(GETTEXT_PACKAGE).pot
	$(MAKE) $(GETTEXT_PACKAGE).pot
	catalogs="$(LINGUAS)"; \
	for lang in $$catalogs; do \
	  printf " %s " "$$lang"; \
	  if $(MSGMERGE) $$lang.po $(GETTEXT_PACKAGE).pot -o $$lang.new.po; then \
	    mv -f $$lang.new.po $$lang.po || exit 1; \
	  else \
	    echo "msgmerge for $$lang failed!"; \
	    rm -f $$lang.new.po; \
	  fi; \
	done

de.mo:
	$(MSGFMT) -o de.mo de.po
es.mo:
	$(MSGFMT) -o es.mo es.po
it.mo:
	$(MSGFMT) -o it.mo it.po
nl.mo:
	$(MSGFMT) -o nl.mo nl.po
ru.mo:
	$(MSGFMT) -o ru.mo ru.po
sv.mo:
	$(MSGFMT) -o sv.mo sv.po
